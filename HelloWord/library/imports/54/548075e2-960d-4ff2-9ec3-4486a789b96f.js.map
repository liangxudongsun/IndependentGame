{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Scripts\\Game/assets\\Scripts\\Game\\Hero.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Scripts\\Game","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\nimport { ConstData } from \"./../Tool/ConstData\";\r\nimport Stick from './Stick';\r\nimport Block from './Block';\r\n\r\n//英雄状态\r\nenum HeroState\r\n{\r\n    HeroIdleEnum = 1,\r\n    HeroAddStick,\r\n    HeroRunEnum,\r\n    HeroDropEnum,\r\n}\r\n\r\n@ccclass\r\nexport default class Hero extends cc.Component\r\n{\r\n    //英雄位置\r\n    private heroPosition: cc.Vec2 = new cc.Vec2(0, 0);\r\n    //英雄状态\r\n    private heroState: HeroState = HeroState.HeroIdleEnum;\r\n    //棍子\r\n    private stick: Stick = null;\r\n    //方块数组\r\n    private blockArray: Array<cc.Node>;\r\n    //英雄移动距离\r\n    private heroMoveDis:number = 0;\r\n\r\n    start()\r\n    {\r\n        this.heroState = HeroState.HeroIdleEnum;\r\n    }\r\n\r\n    update(dt) \r\n    {\r\n        switch (this.heroState)\r\n        {\r\n            case HeroState.HeroIdleEnum:\r\n                break;\r\n            case HeroState.HeroAddStick:\r\n                this.motorStickHight(dt);\r\n                break;\r\n            case HeroState.HeroRunEnum:\r\n                break;\r\n            case HeroState.HeroDropEnum:\r\n                this.heroDrop();\r\n                break;\r\n        }\r\n    }\r\n\r\n    onDestory()\r\n    {\r\n        this.node.removeFromParent(true);\r\n    }\r\n\r\n    /**\r\n     * 设置英雄状态\r\n     */\r\n    public setHeroState(state: number): boolean\r\n    {\r\n        switch (state)\r\n        {\r\n            case 2:\r\n                if (this.heroState == HeroState.HeroIdleEnum)\r\n                {\r\n                    this.stick.resetStick(this.node.getPosition());\r\n                    this.heroState = HeroState.HeroAddStick;\r\n                    return true;\r\n                }\r\n                return false;\r\n            case 3:\r\n                if (this.heroState == HeroState.HeroAddStick)\r\n                {\r\n                    this.heroState = HeroState.HeroRunEnum;\r\n                    return true;\r\n                }\r\n                return false;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 设置棍子索引 \r\n     */\r\n    public setStick(stick: cc.Node)\r\n    {\r\n        this.stick = stick.getComponent(Stick);\r\n    }\r\n\r\n    /**\r\n     * 设置方块数组索引\r\n     */\r\n    public setBlockArray(blockArray: Array<cc.Node>)\r\n    {\r\n        this.blockArray = blockArray;\r\n    }\r\n\r\n    /*\r\n    * 驱动棍子生长\r\n    */\r\n    public motorStickHight(dt: number)\r\n    {\r\n        this.stick.addStickHight(dt);\r\n    }\r\n\r\n    /**\r\n     * 英雄行走\r\n     */\r\n    public heroRun(dt)\r\n    {\r\n        this.stick.putStickDown();\r\n        let distance = this.stick.node.getBoundingBox().size.width;\r\n        this.heroMoveDis = distance + 20;\r\n\r\n        let tempPos = new cc.Vec2(this.node.position.x + this.heroMoveDis,50);\r\n        let rect = cc.rect(tempPos.x,tempPos.y,this.node.getBoundingBox().width,this.node.getBoundingBox().height);\r\n        for (var index = 0; index < this.blockArray.length; index++) \r\n        {\r\n            var element = this.blockArray[index];\r\n            if (element.getBoundingBox().containsRect(rect)) \r\n            {\r\n                let targetX = element.position.x + element.getBoundingBox().width/2;\r\n                let addDis = targetX - tempPos.x;\r\n                this.heroMoveDis += addDis - rect.width/2;\r\n                break;\r\n            }\r\n        }\r\n\r\n        let time = this.heroMoveDis / ConstData.HeroRunSpeed;\r\n        let moveAction = cc.moveBy(time, new cc.Vec2(this.heroMoveDis, 0));\r\n        this.node.runAction(moveAction);\r\n\r\n        this.scheduleOnce(this.runTimeFun, time);\r\n    }\r\n\r\n    /*\r\n    * 英雄掉落\r\n    */\r\n    private heroDrop()\r\n    {\r\n        let moveAction = cc.moveBy(ConstData.HeroTimeDrop, new cc.Vec2(10, -ConstData.HeroDisDrop));\r\n        this.node.runAction(moveAction);\r\n        this.heroState = HeroState.HeroIdleEnum;\r\n\r\n        this.scheduleOnce(this.replaceSceneTimeFun,ConstData.HeroTimeDrop);\r\n    }\r\n\r\n    //场景跳转\r\n    replaceSceneTimeFun = function (event: any)\r\n    {\r\n        cc.director.loadScene(\"scene\");\r\n    }.bind(this)\r\n\r\n    //跑完检测\r\n    runTimeFun = function (event: any)\r\n    {\r\n        this.heroState = HeroState.HeroIdleEnum;\r\n        if (this.checkHeroState()) \r\n        {\r\n            this.moveBlock();   \r\n        }\r\n    }.bind(this)\r\n\r\n    /*\r\n    * 检测是否掉落\r\n    */\r\n    private checkHeroState()\r\n    {\r\n        let live = false;\r\n        for (var index = 0; index < this.blockArray.length; index++) \r\n        {\r\n            var element = this.blockArray[index];\r\n            let blockSize = element.getBoundingBox();\r\n            let heroSize = this.node.getBoundingBox();\r\n\r\n            heroSize.y = 50;\r\n\r\n            if (blockSize.containsRect(heroSize))\r\n            {\r\n                live = true;\r\n                return live;\r\n            }\r\n        }\r\n\r\n        this.heroState = HeroState.HeroDropEnum;\r\n        return live;\r\n    }\r\n\r\n    /*\r\n    * 移动方块\r\n    */\r\n    private moveBlock()\r\n    {\r\n        let heroRunAction = cc.moveBy(0.5,new cc.Vec2(-this.heroMoveDis,0));\r\n        this.node.runAction(heroRunAction);\r\n\r\n        let stickRunAction = cc.moveBy(0.5,new cc.Vec2(-this.heroMoveDis,0));\r\n        this.stick.node.runAction(stickRunAction);\r\n\r\n        for (var index = 0; index < this.blockArray.length; index++) \r\n        {\r\n            let element = this.blockArray[index];\r\n            let elementRunAction = cc.moveBy(0.5,new cc.Vec2(-this.heroMoveDis,0));\r\n            element.runAction(elementRunAction);\r\n        }\r\n    }\r\n}\r\n"]}